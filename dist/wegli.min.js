/*! wegli 0.0.5 16-01-2015 */
/*! Author: Florian Markert */
/*! License: MIT */
"use strict";var getShader=function(a,b,c){var d=a.createShader(c);return a.shaderSource(d,b),a.compileShader(d),d},compileProgram=function(a,b,c){var d=getShader(a,b,a.VERTEX_SHADER),e=getShader(a,c,a.FRAGMENT_SHADER),f=a.createProgram();return a.attachShader(f,d),a.attachShader(f,e),a.linkProgram(f),f},createWebglContext=function(a,b){for(var c,d=0;d<b.types.length;d++){try{c=a.getContext(b.types[d],b.attrs)}catch(e){}if(c)return c}return null},getTransformationMatrix=function(a){var b=a.translate.x,c=a.translate.y,d=a.translate.z,e=a.rotate.x,f=a.rotate.y,g=a.rotate.z,h=a.scaling,i=a.distance,j=a.plane.far,k=a.plane.near,l=a.aspectRatio,m=Math.cos(e),n=Math.sin(e),o=Math.cos(f),p=Math.sin(f),q=Math.cos(g),r=Math.sin(g);if(-k>=i)return new Float32Array([o*q*h/l,o*h*r,-h*p,0,h*(q*n*p-m*r)/l,h*(n*p*r+m*q),o*h*n,0,h*(n*r+m*q*p)/l,h*(m*p*r-q*n),m*o*h,0,h*(q*((-c*n-m*d)*p-o*b)-(d*n-m*c)*r)/l,h*(((-c*n-m*d)*p-o*b)*r+q*(d*n-m*c)),h*(b*p+o*(-c*n-m*d)),1]);var s=i,t=(k+j+2*i)/(j-k),u=-(i*(2*k+2*j)+2*j*k+2*i*i)/(j-k);return new Float32Array([o*q*h*s/l,o*h*r*s,-h*p*t,-h*p,h*(q*n*p-m*r)*s/l,h*(n*p*r+m*q)*s,o*h*n*t,o*h*n,h*(n*r+m*q*p)*s/l,h*(m*p*r-q*n)*s,m*o*h*t,m*o*h,h*(q*((-c*n-m*d)*p-o*b)-(d*n-m*c)*r)*s/l,h*(((-c*n-m*d)*p-o*b)*r+q*(d*n-m*c))*s,u+(h*(b*p+o*(-c*n-m*d))+i)*t,h*(b*p+o*(-c*n-m*d))+i])},initWebgl=function(a){a.transformValues={translate:{x:0,y:0,z:0},rotate:{x:0,y:0,z:0},aspectRatio:1,scaling:1,distance:1,plane:{far:1,near:-1}},a.transformCoordinates=getTransformationMatrix(a.transformValues)};!function(a){var b=function(){var a={vertexFloating:"\nattribute vec3 position;\nuniform float shift;\nuniform float ps;\nvarying float height;\nuniform mat4 uPMatrix;\nvoid main(void) {\ngl_Position = uPMatrix * vec4(position.x - shift, position.y, position.z, 1.);\nheight=-4.0*position.z;\ngl_PointSize = ps;\n}",vertexAging:"\nattribute vec3 position;\nattribute float birth;\nvarying float height;\nuniform mat4 uPMatrix;\nuniform float ps;\nuniform float date;\nvoid main(void) {\nfloat zpos = position.z+date-birth;\nif (zpos > 0.0) zpos = 0.0;\nif (zpos < -2.0) zpos = -2.0;\ngl_Position = uPMatrix * vec4(position.x, position.y, zpos, 1.);\nheight=-4.0*zpos;\ngl_PointSize = ps;\n}",fragmentColor:"\nprecision mediump float;\nvarying float height;\nvoid main(void) {\nvec3 cs = vec3(0.5,0,0);\nif (0.0 <= height && height <= 0.5) cs = vec3(0,0,height+0.5);\nelse if (0.5 < height && height <= 1.5) cs = vec3(0,height-0.5,1);\nelse if (1.5 < height && height <= 2.5) cs = vec3(height-1.5,1,2.5-height);\nelse if (2.5 < height && height <= 3.5) cs = vec3(1,3.5-height,0);\nelse if (3.5 < height && height <= 4.0) cs = vec3(4.5-height,0,0);\ngl_FragColor = vec4(cs, 1.);\n}",fragmentBw:"\nprecision mediump float;\nvarying float height;\nvoid main(void) {\nvec3 cs = vec3(height/4.0,height/4.0,height/4.0);\ngl_FragColor = vec4(cs, 1.);\n}"},b={getHeatmapShader:function(b,c){var d=a.fragmentBw;c&&(d=a.fragmentColor);var e=compileProgram(b,a.vertexAging,d);e.position=b.getAttribLocation(e,"position"),e.birth=b.getAttribLocation(e,"birth"),e.transformation=b.getUniformLocation(e,"uPMatrix"),e.pointSize=b.getUniformLocation(e,"ps"),e.date=b.getUniformLocation(e,"date"),b.enableVertexAttribArray(e.position),b.enableVertexAttribArray(e.birth),b.myPrograms||(b.myPrograms={}),c?b.myPrograms.heatmapShaderC=e:b.myPrograms.heatmapShaderBw=e},getFloatingShader:function(b,c){var d=a.fragmentBw;c&&(d=a.fragmentColor);var e=compileProgram(b,a.vertexFloating,d);e.position=b.getAttribLocation(e,"position"),e.shift=b.getUniformLocation(e,"shift"),e.pointSize=b.getUniformLocation(e,"ps"),e.transformation=b.getUniformLocation(e,"uPMatrix"),b.enableVertexAttribArray(e.position),b.enableVertexAttribArray(e.currentShift),b.myPrograms||(b.myPrograms={}),c?b.myPrograms.floatingShaderC=e:b.myPrograms.floatingShaderBw=e}};return b};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=b:(a.HeatmapShader=b,"function"==typeof define&&define.amd&&define(b))}(window),function(a){var b=function(){var a={vertex:"\nattribute vec2 position;\nattribute vec3 color;\nvarying vec3 vc;\nuniform mat4 uPMatrix;\nvoid main(void) {\ngl_Position = vec4(position, 0., 1.);\ngl_PointSize = 2.0;\nvc=color;\n}",fragment:"\nprecision mediump float;\nvarying vec3 vc;\nvoid main(void) {\ngl_FragColor = vec4(vc, 1.);\n}"},b={getShader:function(b){var c=compileProgram(b,a.vertex,a.fragment);c.color=b.getAttribLocation(c,"color"),c.position=b.getAttribLocation(c,"position"),c.transformation=b.getUniformLocation(c,"uPMatrix"),b.enableVertexAttribArray(c.color),b.enableVertexAttribArray(c.position),b.myPrograms||(b.myPrograms={}),b.myPrograms.polygonShader=c}};return b};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=b:(a.PolygonShader=b,"function"==typeof define&&define.amd&&define(b))}(window),function(a){var b=function(){var a={vertex2d:"\nattribute vec3 position;\nattribute vec4 inputTextureCoordinate;\nvarying vec2 textureCoordinate;\nvoid main(void) {\ngl_Position = vec4(position, 1.);\ntextureCoordinate = inputTextureCoordinate.xy;\n}",vertex3d:"\nattribute vec3 position;\nattribute vec4 inputTextureCoordinate;\nuniform mat4 uPMatrix;\nvarying vec2 textureCoordinate;\nvoid main(void) {\ngl_Position = uPMatrix * vec4(position, 1.);\ntextureCoordinate = inputTextureCoordinate.xy;\n}",fragment:"\nprecision mediump float;\nvarying vec2 textureCoordinate;\nuniform sampler2D uSampler;\nvoid main(void) {\ngl_FragColor = texture2D(uSampler, textureCoordinate);\n}"},b={getShader3d:function(b){var c=compileProgram(b,a.vertex3d,a.fragment);c.texCoord=b.getAttribLocation(c,"inputTextureCoordinate"),c.texPos=b.getAttribLocation(c,"position"),c.sampler=b.getUniformLocation(c,"uSampler"),c.pMatrixUniform=b.getUniformLocation(c,"uPMatrix"),b.enableVertexAttribArray(c.texCoord),b.enableVertexAttribArray(c.texPos),b.myPrograms||(b.myPrograms={}),b.myPrograms.textureShader3d=c},getShader2d:function(b){var c=compileProgram(b,a.vertex2d,a.fragment);c.texCoord=b.getAttribLocation(c,"inputTextureCoordinate"),c.texPos=b.getAttribLocation(c,"position"),c.sampler=b.getUniformLocation(c,"uSampler"),b.enableVertexAttribArray(c.texCoord),b.enableVertexAttribArray(c.texPos),b.myPrograms||(b.myPrograms={}),b.myPrograms.textureShader2d=c}};return b};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=b:(a.TextureShader=b,"function"==typeof define&&define.amd&&define(b))}(window),function(a){var b=function(a){a.depthFunc(a.LEQUAL),(new PolygonShader).getShader(a);var b=a.myPrograms.polygonShader,c=a.createBuffer(),d=a.createBuffer(),e={};initWebgl(e);var f=function(b,c,d,e){a.bindBuffer(a.ARRAY_BUFFER,d),a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW),a.vertexAttribPointer(b,e,a.FLOAT,!1,0,0)},g=function(c,d){a.lineWidth(3),a.uniformMatrix4fv(b.transformation,!1,e.transformCoordinates),a.drawArrays(c,0,d)},h={draw:function(e,h,i){a.useProgram(b),f(b.position,e,c,2),f(b.color,h,d,3),g(a[i],e.length/2)},transform:function(a){e.transformValues=a,e.transformCoordinates=getTransformationMatrix(e.transformValues)}};return h};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=b:(a.attachPloygonShader=b,"function"==typeof define&&define.amd&&define(b))}(window),function(a){var b=function(a,b){var c={};initWebgl(c),(new HeatmapShader).getHeatmapShader(a,!1),(new HeatmapShader).getHeatmapShader(a,!0);var d=a.myPrograms.heatmapShaderC,e=a.myPrograms.heatmapShaderBw,f=a.createBuffer(),g={};g.setPixel=function(){},g.age=0,g.pointSize=1;var h=function(b,c){var d=0,e=0;g.age=0,g.arraySize=4*b*c,g.vertices=new Float32Array(g.arraySize);for(var h=0;b>h;h++){var i=e;d-=2/b;for(var j=0;c>j;j++){var k=new Float32Array(4);k[0]=d+1,k[1]=2*j/c-1,k[2]=0,k[3]=0,e=(i+4*j)%g.arraySize,g.vertices.set(k,e)}e=(i+4*c)%g.arraySize}a.bindBuffer(a.ARRAY_BUFFER,f),a.bufferData(a.ARRAY_BUFFER,g.vertices,a.DYNAMIC_DRAW),g.setPixel=function(d,e,f){if(0>d||d>b||0>e||e>c)return!1;var h=(b-d+1)*c*4-4*e,i=g.vertices[h+2]-g.vertices[h+3]+g.age,j=i-f;i>f?j=-f:-1>j&&(j=-1),g.vertices[h+2]=j,g.vertices[h+3]=g.age,a.bufferSubData(a.ARRAY_BUFFER,4*h+8,g.vertices.subarray(h+2,h+4))}};b?h(b.x,b.y):h(100,100);var i=function(b,d,e,f){a.useProgram(f),a.blendFunc(a.SRC_ALPHA,a.ONE),a.enable(a.DEPTH_TEST),a.bindBuffer(a.ARRAY_BUFFER,e),a.vertexAttribPointer(f.position,3,a.FLOAT,!1,16,0),a.vertexAttribPointer(f.birth,1,a.FLOAT,!1,16,12),a.lineWidth(1),a.uniform1f(f.date,g.age),a.uniform1f(f.pointSize,g.pointSize),a.uniformMatrix4fv(f.transformation,!1,c.transformCoordinates),a.drawArrays(a[d],0,g.arraySize/4)},j={reinitBuffer:function(a,b){return h(a,b)},transform:function(a){c.transformValues=a,c.transformCoordinates=getTransformationMatrix(c.transformValues)},drawBw:function(a,b){i(a,b,f,e)},drawC:function(a,b){i(a,b,f,d)},setPixel:g.setPixel,age:function(a){g.age+=a},setPointSize:function(a){g.pointSize=a}};return j};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=b:(a.attachHeatmapShader=b,"function"==typeof define&&define.amd&&define(b))}(window),function(a){var b=function(a,b){var c={};initWebgl(c),(new HeatmapShader).getFloatingShader(a,!1),(new HeatmapShader).getFloatingShader(a,!0);var d=a.myPrograms.floatingShaderC,e=a.myPrograms.floatingShaderBw,f=a.createBuffer(),g={};g.setColumn=function(){},g.pointSize=1;var h=function(b,c){var d=0,e=0;g.xOffset=0,g.speed=2/b,g.columnPointer=0,g.arraySize=3*b*c,g.vertices=new Float32Array(g.arraySize);for(var h=0;b>h;h++){var i=e;d-=2/b;for(var j=0;c>j;j++){var k=new Float32Array(3);k[0]=0,k[1]=0,k[2]=0,e=(i+3*j)%g.arraySize,g.vertices.set(k,e)}e=(i+3*c)%g.arraySize}a.bindBuffer(a.ARRAY_BUFFER,f),a.bufferData(a.ARRAY_BUFFER,g.vertices,a.DYNAMIC_DRAW),g.setColumn=function(d){a.bindBuffer(a.ARRAY_BUFFER,f);var e=12*g.arraySize,h=g.columnPointer*c*12,i=0;if(d.length<c)for(d.length=c,i=d.length;c>i;i++)d[i]=0;for(i=0;c>i;i++){var j=new Float32Array(3);j[0]=g.xOffset+1,j[1]=2*i/d.length-1,j[2]=-d[i],a.bufferSubData(a.ARRAY_BUFFER,(h+12*i)%e,j)}g.columnPointer=(g.columnPointer+1)%b,g.xOffset+=g.speed}};b?h(b.x,b.y):h(100,100);var i=function(b,d,e){a.useProgram(e),a.blendFunc(a.SRC_ALPHA,a.ONE),a.enable(a.DEPTH_TEST),a.bindBuffer(a.ARRAY_BUFFER,d),a.vertexAttribPointer(e.position,3,a.FLOAT,!1,12,0),a.lineWidth(1),a.uniform1f(e.shift,g.xOffset),a.uniformMatrix4fv(e.transformation,!1,c.transformCoordinates),a.uniform1f(e.pointSize,g.pointSize),a.drawArrays(a[b],0,g.arraySize/3)},j={reinitBuffer:function(a,b){return h(a,b)},transform:function(a){c.transformValues=a,c.transformCoordinates=getTransformationMatrix(c.transformValues)},drawBw:function(a){i(a,f,e)},drawC:function(a){i(a,f,d)},setColumn:g.setColumn,setPointSize:function(a){g.pointSize=a}};return j};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=b:(a.attachWaterfallShader=b,"function"==typeof define&&define.amd&&define(b))}(window),function(a){var b=function(a){(new TextureShader).getShader2d(a);var b=a.myPrograms.textureShader2d;(new TextureShader).getShader3d(a);var c=a.myPrograms.textureShader3d,d=document.createElement("canvas").getContext("2d");d.canvas.width=256,d.canvas.height=256;var e={};initWebgl(e);var f={},g=[],h=1,i=64,j={},k={},l=a.createBuffer(),m=a.createBuffer();j.n=[-1,-1,0,1,-1,0,-1,1,0,1,1,0],j.x=[0,-1,-1,0,1,-1,0,-1,1,0,1,1],j.y=[-1,0,-1,1,0,-1,-1,0,1,1,0,1],j.z=[-1,-1,0,1,-1,0,-1,1,0,1,1,0],k.x=[0,1,1,1,0,0,1,0],k.y=[1,1,0,1,1,0,0,0],k.z=[1,1,0,1,1,0,0,0],k.n=[0,0,1,0,0,1,1,1];var n=function(a){d.font=a.font,d.fillStyle=a.fill,d.strokeStyle=a.stroke,d.textAlign="left",d.textBaseline="bottom"},o=function(a){return a&a-1?!1:!0},p=function(a){if(f[a]={},f[a].used=new Date,i>h)return f[a].id=h,h++,h-1;var b,c,d,e=-Number.MAX_VALUE;for(b in f)f[a].used-f[b].used>e&&(e=f[a].used-f[b].used,c=b),0===f[b].id&&(d=b);return e>1e3?(f[a].id=f[c].id,delete f[c]):(f[a].id=0,d&&delete f[d]),f[a].id},q=function(a,b){d.clearRect(0,0,d.canvas.width,d.canvas.height),n(b),d.fillText(a,d.canvas.width/2,d.canvas.height/2)},r=function(b,f,h){"n"!==b.plane&&(a.useProgram(c),a.uniformMatrix4fv(c.pMatrixUniform,!1,e.transformCoordinates)),f&&(g[h]?a.isTexture(g[h])||(g[h]=a.createTexture()):g[h]=a.createTexture(),a.bindTexture(a.TEXTURE_2D,g[h]),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),o(d.canvas.width)&&o(d.canvas.height)?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE)))},s=[],t=function(e,f,h,i){var n;a.enable(a.DEPTH_TEST),a.blendFunc(a.SRC_ALPHA,a.ONE),a.enable(a.BLEND),a.depthFunc(a.LEQUAL),n="n"!==e.plane?c:b,a.useProgram(n),s.length=0;var o=d.canvas.width/a.canvas.width,p=d.canvas.height/a.canvas.height,q=1;"y"===e.plane?(q=p,p=1):"x"===e.plane&&(q=p,p=o,o=1);for(var r=0;r<j[e.plane].length/3;r++)s[3*r]=j[e.plane][3*r]*o+e.pos[0],s[3*r+1]=j[e.plane][3*r+1]*p+e.pos[1],s[3*r+2]=j[e.plane][3*r+2]*q+e.pos[2];i||a.bindTexture(a.TEXTURE_2D,g[h]),a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,l),a.bufferData(a.ARRAY_BUFFER,new Float32Array(s),a.STATIC_DRAW),a.vertexAttribPointer(n.texPos,3,a.FLOAT,0,0,s),a.bindBuffer(a.ARRAY_BUFFER,m),a.bufferData(a.ARRAY_BUFFER,new Float32Array(k[e.plane]),a.STATIC_DRAW),a.vertexAttribPointer(n.texCoord,2,a.FLOAT,0,0,k[e.plane]),i&&f&&f.width>0&&f.height>0&&a.canvas.height>0&&a.canvas.width>0&&(a.uniform1i(n.sampler,0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,f)),f&&f.width>0&&f.height>0&&a.canvas.height>0&&a.canvas.width>0&&a.drawArrays(a.TRIANGLE_STRIP,0,4),a.disable(a.BLEND)},u={writeText:function(a,b){var c=b.font+b.fill+b.stroke;if(f[a+c])f[a+c].used=new Date,r(b,!1,f[a+c].id),t(b,d.canvas,f[a+c].id,!1);else{var e=p(a+c);r(b,!0,e),q(a,b),t(b,d.canvas,e,!0)}},transform:function(a){e.transformValues=a,e.transformCoordinates=getTransformationMatrix(e.transformValues)},drawTexture:function(a,b){r(b,b.redraw,0),t(b,a,0,b.redraw)},setTextureSize:function(a,b){d.canvas.width=a,d.canvas.height=b},setTextureBufferSize:function(a){i=a}};return u};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=b:(a.attachTextureShader=b,"function"==typeof define&&define.amd&&define(b))}(window);